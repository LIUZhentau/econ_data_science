
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. 从非参数到机器学习 &#8212; 经济学中的“数据科学”</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="8. 基于预测的算法" href="09-ML2-CN.html" />
    <link rel="prev" title="6. 数值最优化" href="07-optimization-CN.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="zh_CN">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">经济学中的“数据科学”</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00-preface.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-basic_R-CN.html">
   1. 基础R语言
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-advanced_R-CN.html">
   3. R语言进阶
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-integration-CN.html">
   4. 积分
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-simulation-CN.html">
   5. 模拟
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07-optimization-CN.html">
   6. 数值最优化
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   7. 从非参数到机器学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09-ML2-CN.html">
   8. 基于预测的算法
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/zhentaoshi/econ_data_science/master?urlpath=tree/docs/08-ML-CN.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/zhentaoshi/econ_data_science"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/zhentaoshi/econ_data_science/issues/new?title=Issue%20on%20page%20%2F08-ML-CN.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/08-ML-CN.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   7.1. 非参数估计
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   7.2. 数据分割
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     7.2.1. 交叉验证
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id10">
   7.3. 参数选择与预测
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id18">
   7.4. 计量经济学中的压缩估计
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id24">
   7.5. 实证应用
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id28">
   7.6. 拓展阅读
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>从非参数到机器学习</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   7.1. 非参数估计
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   7.2. 数据分割
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     7.2.1. 交叉验证
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id10">
   7.3. 参数选择与预测
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id18">
   7.4. 计量经济学中的压缩估计
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id24">
   7.5. 实证应用
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id28">
   7.6. 拓展阅读
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">7. </span>从非参数到机器学习<a class="headerlink" href="#id1" title="永久链接至标题">#</a></h1>
<p>近年来，机器学习发展势头迅猛，其思想广泛应用于各个领域，从学术研究到生活日常都能见到它的身影。<span id="id2">[]</span> 是一篇适合研究生入门的权威文献。当中机器学习的思想也能够应用于经济学的研究中。<span id="id3">[]</span> 讨论了机器学习技术对经济学分析的冲击；<span id="id4">[]</span> 研究了一些常见的方法并用实例加以展示；<span id="id5">[]</span> 介绍了新技术 <strong>人工智能</strong> 和背后暗含的经济学模型。</p>
<p>两个机器学习中常用的方法是 <strong>监督学习</strong> 和 <strong>非监督学习</strong> 。简单来说，前者是研究 <span class="math notranslate nohighlight">\(X\)</span> 和 <span class="math notranslate nohighlight">\(Y\)</span> 的关系，而后者则仅研究 <span class="math notranslate nohighlight">\(X\)</span> 。前者在实际中的例子是各种的回归和分类方法，后者的常见应用则是密度分析、主成分分析和聚类分析等。上述例子都是熟悉的计量经济学问题。</p>
<p>从计量经济学者的视角来看，监督机器学习就是通过拟合样本数据来预测样本外的规律。我们可以借用回归的知识来理解背后的原理——如果重复 <span class="math notranslate nohighlight">\(n\)</span> 次试验得到数据集 <span class="math notranslate nohighlight">\((y_i, x_i)_{i=1}^n\)</span> ，在已知 <span class="math notranslate nohighlight">\(x_{n+1}\)</span> 时通过什么方法能够精准预测 <span class="math notranslate nohighlight">\(y_{n+1}\)</span> 呢？</p>
<p>机器学习是跳出传统统计学的全新研究范式。当统计学者提出一种估计量时，常规的流程是逐个推导它的三大性质（相合性，有效性和无偏性）。一般先证明相合性，这是统计量的基本要求。在此基础上，我们还要找出它的渐进分布。理想情况下，渐近分布是正态的，这样统计量就会有一些便捷的性质，统计推断也更加方便。而且，我们还希望渐近正态估计量满足有效性。有效性要求估计量在一系列的渐近正态估计量中有最小的方差。不仅如此，计量经济学者们还关心实证结果中的模型识别和经济学解释。计量经济学主要处理数据和模型之间的关系。从总体水平看，我们需要考虑识别的问题。一旦我们关心的参数识别成功，我们就可以进行参数估计和推断。最后，我们解读这些结果，并希望它们能够对经济学理论提供一些参考。</p>
<p>机器识别则不需要经过这些流程。首先，它们认为数据集足够大的时候，方差通常都会很小，因此不需要考虑有效性的问题。其次，在许多的情况中我们并不关心统计推断的结果，因此我们不必在意推断的步骤。例如，亚马逊或者淘宝的推荐算法背后就是机器学习在支持，我们真正关心的是预测的准确性，而不会在意A商品的消费者倾向于购买B商品背后的因果关系。再者，这个世界是一个非常复杂的系统，我们不可能清楚知道数据生成的具体机制。我们无需假定一个数据生成机制(data generating process DGP)。如果DGP不存在，那么我们根本无需谈论相合性的存在与否。如果没有所谓的“真实值”存在，估计量又怎么会收敛呢？基于上述的讨论，传统统计学的范式显然不再可靠。放到计量经济学中，这样观点无疑否认了结构化模型传统方法(the Cowles approach)。</p>
<p>对于这些“辩论”感兴趣的读者可以参考 <span id="id6">[]</span>。在本章节的学习中，我们暂不讨论这些辩论，而是学习经济学中较为流行的几种机器学习方法。</p>
<section id="id7">
<h2><span class="section-number">7.1. </span>非参数估计<a class="headerlink" href="#id7" title="永久链接至标题">#</a></h2>
<p><strong>参数化</strong> 涉及的是参数数量有限的问题，而 <strong>非参数</strong> 则是指参数无限的情况。对于统计学者来说，非参数不是什么新鲜事物。不过，这个理论中的一些思路与机器学习有着千丝万缕的联系。</p>
<p>以一个给定样本 <span class="math notranslate nohighlight">\((x_1,\ldots,x_n)\)</span> 的密度估计为例，如果我们假设样本来源于参数族，比如正态分布，就可以用最大似然估计来求得均值和方差。然而，如果选错了参数族，极大似然估计就不相合了，我们最多得到一个<strong>伪真实值</strong>(<em>pseudo true value</em>)。在现实中，我们往往无法判断哪个是正确的参数族。如果我们不假设参数族，那么理论上我们就应该用无限参数去表示密度。直方图就是一个大家都熟悉的非参数估计，直方图的形状取决于底部的分区，如果分得太细，每个部分里只有少数几个观测值。尽管偏误很小，但是数据就会有很大的方差。相反，如果分类过于粗糙，每个部分会很宽。尽管它的方差很小，每个部分会有很多的观测值，但是最终会有很大的偏误。在非参数模型中，偏误和方差此消彼长，两者不可兼得是非参数估计乃至全部的机器学习方法的特有性质。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">&lt;-</span> <span class="m">200</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>

<span class="n">x_base</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">by</span> <span class="o">=</span> <span class="m">0.01</span><span class="p">)</span>
<span class="n">breaks_list</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">60</span><span class="p">)</span>

<span class="nf">for </span><span class="p">(</span><span class="n">ii</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">){</span>
  <span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">rbeta</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="c1"># beta distribution</span>
  <span class="nf">for </span><span class="p">(</span> <span class="n">bb</span> <span class="n">in</span> <span class="n">breaks_list</span><span class="p">){</span>
    <span class="nf">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">breaks</span> <span class="o">=</span> <span class="n">bb</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
    <span class="nf">lines</span><span class="p">(</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">dbeta</span><span class="p">(</span> <span class="n">x_base</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x_base</span> <span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span> <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08-ML-CN_5_0.png" src="_images/08-ML-CN_5_0.png" />
</div>
</div>
<p>非参数估计的另一个例子是给定样本 <span class="math notranslate nohighlight">\((y_i, x_i)\)</span> 的条件均值<span class="math notranslate nohighlight">\(f(x) = E[y_i |x_i = x]\)</span> 。这是我们在本科计量经济学第一课中遇到的例子。我们求解最小化函数：</p>
<div class="math notranslate nohighlight">
\[
\min_f E[ (y_i - f(x_i) )^2 ]
\]</div>
<p>条件均值往往是非线性的函数。如果我们不了解 <span class="math notranslate nohighlight">\((y_i,x_i)\)</span> 背后的参数估计，估计 <span class="math notranslate nohighlight">\(f(x)\)</span> 就变成了一个非参数的问题。在现实中，样本数量 <span class="math notranslate nohighlight">\(n\)</span> 通常是有限的。样本最小化函数为：</p>
<div class="math notranslate nohighlight">
\[
\min_f \sum_{i=1}^n (y_i - f(x_i) )^2.
\]</div>
<p>在求解最小值的时候，我们仍然需要约束函数的类型。如果我们假设 <span class="math notranslate nohighlight">\(f\)</span> 是一个连续函数，我们可以使用基于密度估计的核 (kernel) 算法。
另一种方法是用级数展开来估计函数。级数展开会生成许多额外的估计量，我们就可以估计它们的系数。这是在线性回归的右边“创建”许多变量的方法。
比如，任何的有界微分差分函数都有级数 <span class="math notranslate nohighlight">\(f(x) = \sum_{k=0}^{\infty} \beta_k \cos (\frac{k}{2}\pi x )\)</span> 。在有限样本中，我们选择随意一个有限数字 <span class="math notranslate nohighlight">\(K\)</span> (通常比 <span class="math notranslate nohighlight">\(n\)</span> 小得多) 作为截断点。
当 <span class="math notranslate nohighlight">\(n \to \infty\)</span> 时，<span class="math notranslate nohighlight">\(K \to \infty\)</span> 于是：</p>
<div class="math notranslate nohighlight">
\[
f_K(x) = \sum_{k=0}^{K} \beta_k \cos \left(\frac{k}{2}\pi x \right) \to f(x).
\]</div>
<p>在这个非参数估计中，同样存在偏误-方差的取舍。如果 <span class="math notranslate nohighlight">\(K\)</span> 太大了, <span class="math notranslate nohighlight">\(f\)</span> 过于灵活，它将会达到 <span class="math notranslate nohighlight">\(100\%\)</span> 的样本内 R 平方。这对于样本外预测没有什么帮助。
这样的预测会有很小的偏误，但是有很大的方差。另一个极端是，一个非常小的 <span class="math notranslate nohighlight">\(K\)</span> 会让 <span class="math notranslate nohighlight">\(f_K(x)\)</span> 过于严苛，不能估计一般的非线性函数。它会有很大的偏误和较小的方差。</p>
<p>偏误-方差的权衡是控制计算效果的基本统计机制。因此我们需要用 <strong>正则化</strong> 在均方差中平衡二者。正则化的两种常见方法是选择带宽和展开级数的项数。
第三种正则化的方法是得到一个足够大的 <span class="math notranslate nohighlight">\(K\)</span> ，然后加上一个惩罚项来控制级数的复杂性。最优化问题为：</p>
<div class="math notranslate nohighlight">
\[
\min_\beta \  \frac{1}{2n}  \sum_{i=1}^n \left(y_i - \sum_{k=0}^{K} \beta_k f_k(x_i) \right)^2
+ \lambda \sum_{k=0}^K \beta_k^2,
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\lambda\)</span> 是调谐参数，这样当 <span class="math notranslate nohighlight">\(n\to \infty\)</span> 时 <span class="math notranslate nohighlight">\(\lambda \to 0\)</span> ，且
<span class="math notranslate nohighlight">\(f_k(x_i) = \cos \left(\frac{k}{2}\pi x_i \right)\)</span> 。为了简化符号，令 <span class="math notranslate nohighlight">\(y=(y_1,\ldots,y_n)'\)</span> 且
<span class="math notranslate nohighlight">\(X = (X_{ik} = f_k(x_i) )\)</span> ，上述问题可以被重写为：</p>
<div class="math notranslate nohighlight">
\[
(2n)^{-1} (Y-X\beta)'(Y-X\beta) + \lambda \Vert \beta \Vert_2 ^2,
\]</div>
<p>上述的最优化函数有一个显性解 <span class="math notranslate nohighlight">\(\hat{\beta} = (X'X+\lambda I)^{-1} X'Y\)</span> 。这是在20世纪70年代提出的 <strong>岭回归</strong> (ridge regression) 。
这里的惩罚方式和我们下个章节将要讨论的变量选择十分类似。</p>
<p>实际中会遇到的问题是，面对一个正则化问题，该如何选择调谐参数？这是一个学界普遍讨论的棘手的统计学问题。主流的理论是要么使用一个 <strong>信息量准则</strong> (例如赤池信息量 <span class="math notranslate nohighlight">\(\log\hat{\sigma}^2 + 2K\)</span> 或者贝叶斯信息量 <span class="math notranslate nohighlight">\(\log\hat{\sigma}^2 + K\log n\)</span> )，或者<strong>交叉验证</strong> 。</p>
</section>
<section id="id8">
<h2><span class="section-number">7.2. </span>数据分割<a class="headerlink" href="#id8" title="永久链接至标题">#</a></h2>
<p>机器学习的流程和计量经济学大不相同，它的核心的目的往往是预测而不是解释。
他们会选择一些现成的通用学习方法，然后用它们的预测效果来评估好坏。为了避免过度拟合的问题，我们还必须要设置一些调谐参数。</p>
<p>大多数的机器学习对于DGP都抱着不可知的观点。他们大方地承认模型的不确定性。为了处理模型选择的问题(调谐参数的选择)，
我们将充足的数据分成三个部分：一个 <strong>训练数据集</strong> 用来拟合模型(给定调谐参数)；一个 <strong>验证数据集</strong> 用来比较不同调谐参数得到的样本外预测的效果，它可以辅助我们确定目标调谐参数；
理想情况下，<strong>测试样本</strong> 应该是独立于模型的第三方。测试样本是测试模型拟合效果的最终评判标准。</p>
<p>R 包 <code class="docutils literal notranslate"><span class="pre">caret</span></code> (Classification And REgression Training) 提供了许多机器学习方法的框架。
函数 [<code class="docutils literal notranslate"><span class="pre">createDataPartition</span></code>] (<a class="reference external" href="https://topepo.github.io/caret/data-splitting.html">https://topepo.github.io/caret/data-splitting.html</a>)
能够帮助我们分割截面数据和时间序列数据。</p>
<section id="id9">
<h3><span class="section-number">7.2.1. </span>交叉验证<a class="headerlink" href="#id9" title="永久链接至标题">#</a></h3>
<p>一个 <span class="math notranslate nohighlight">\(S\)</span> 折叠交叉验证把数据集分为 <span class="math notranslate nohighlight">\(S\)</span> 个互不相交的部分。在每一次的迭代中，它挑选其中一个部分作为验证的样本，其他的 <span class="math notranslate nohighlight">\(S-1\)</span> 个部分作为训练样本之后测算出拟合优度。例如 <strong>均方预测误差</strong> <span class="math notranslate nohighlight">\({n_v}^{-1} \sum_{i \in val} (y_i - \hat{y}_i)^2\)</span> ，其中 <span class="math notranslate nohighlight">\(val\)</span> 是验证集，<span class="math notranslate nohighlight">\(n_v\)</span> 是其元素的个数(cardinality)，或者 <strong>绝对均值预测误差</strong> <span class="math notranslate nohighlight">\({n_v}^{-1}\sum_{i \in val} |y_i - \hat{y}_i|\)</span>。重复这个流程 <span class="math notranslate nohighlight">\(S\)</span> 次使得每一个 <span class="math notranslate nohighlight">\(S\)</span> 部分都被当做了验证样本， <span class="math notranslate nohighlight">\(S\)</span> 个部分拟合优度的均值用来决定最优的调谐参数。如果 <span class="math notranslate nohighlight">\(S=n-1\)</span>，它被称为 <strong>留一交叉验证</strong>，但是当 <span class="math notranslate nohighlight">\(n\)</span> 很大的时候，计算量过于庞大，因此在实际操作中，我们可以选择 <span class="math notranslate nohighlight">\(S=5\)</span> 或 10，分别称为5折交叉验证和10折交叉验证。</p>
<p>\begin{figure}
\centering
\includegraphics[width = 14cm]{graph/CV_Figure}
\caption{Rolling window time series cross validation}
\end{figure}</p>
<p>在时间序列中， 交叉验证一定要保留相依结构 (dependence structure)。 如果时间序列是平稳的，我们可以把数据分为 <span class="math notranslate nohighlight">\(S\)</span> 个连续的部分。 如果我们的目的是提前预测，那么我们可以用 <strong>嵌套CV验证</strong> 。该数据展示了一个有固定长度移动窗口的嵌套CV验证，而它的次级训练数据也同样可以是一个扩展滚动窗口。</p>
</section>
</section>
<section id="id10">
<h2><span class="section-number">7.3. </span>参数选择与预测<a class="headerlink" href="#id10" title="永久链接至标题">#</a></h2>
<p>在当代的学术研究中，协变量 <span class="math notranslate nohighlight">\(x_i\)</span> 的数量可能非常庞大。DNA的基因晶片分析是一种寻找症状和基因之间联系的方法。生物学理论指出，仅有一小部分的基因会影响症状，但哪些是真正的罪魁祸首我们不得而知。变量选择就能帮助我们找出相关基因，之后我们就能思考如何通过编辑这些基因来预防特定的疾病并改善人们的生活。</p>
<p>一些的实证问题中有大量的解释变量，
例如<a class="reference external" href="https://discover.ukdataservice.ac.uk/series/?sn=2000028">UK Living Costs and Food Survey</a> 的一个数千个问题的问卷。该调查被广泛用于需求理论和家庭消费的研究。
<span id="id11">[]</span><a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3031893">link</a> 在6个常用数据集当中测试了变量选择方法。</p>
<p><strong>模型选择风险</strong> 阐述了为了追求显著性，从两个模型中选择 <span class="math notranslate nohighlight">\(t\)</span> 统计量时检验规模失真的问题。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}y\\
x_{1}\\
x_{2}
\end{pmatrix}\sim N\left(0,\begin{pmatrix}1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; \sqrt{0.5}\\
0 &amp; \sqrt{0.5} &amp; 1
\end{pmatrix}\right)
\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(x_1\)</span> 和 <span class="math notranslate nohighlight">\(x_2\)</span> 都独立于 <span class="math notranslate nohighlight">\(y\)</span> 。检验规模取决于两个回归量的相关性。
如果只在一个模型中实行检验，那么规模是预先设定的10%。
如果我们尝试检验两个模型，规模会扩大到大约17%。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">&lt;-</span> <span class="m">100</span>
<span class="n">Rep</span> <span class="o">&lt;-</span> <span class="m">5000</span>

<span class="n">t_stat</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">beta_hat</span> <span class="o">&lt;-</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
  <span class="n">e_hat</span> <span class="o">&lt;-</span> <span class="n">y</span> <span class="o">-</span> <span class="n">beta_hat</span> <span class="o">*</span> <span class="n">x</span>
  <span class="n">sigma2_hat</span> <span class="o">&lt;-</span> <span class="nf">var</span><span class="p">(</span><span class="n">e_hat</span><span class="p">)</span>
  <span class="n">t_stat</span> <span class="o">&lt;-</span> <span class="n">beta_hat</span> <span class="o">/</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">sigma2_hat</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">))</span>
  <span class="nf">return</span><span class="p">(</span><span class="n">t_stat</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">res</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span> <span class="n">Rep</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>

<span class="nf">for </span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">Rep</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="n">x1</span> <span class="o">&lt;-</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="n">x2</span> <span class="o">&lt;-</span> <span class="nf">sqrt</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="nf">sqrt</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

  <span class="n">res</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="nf">t_stat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x1</span><span class="p">),</span> <span class="nf">t_stat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="nf">apply</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="m">1</span><span class="p">,</span> <span class="n">max</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nf">qnorm</span><span class="p">(</span><span class="m">0.95</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 0.1706
</pre></div>
</div>
</div>
</div>
<p>应用经济学家经常依赖过往经验挑选模型的变量，但他们却总是很抗拒变量选择问题。近年来，经济学家逐渐意识到了先前在这一领域的疏忽。
<span id="id12">[]</span> 应用了一系列的变量选择方法，预测了 143 个美国的宏观指标。</p>
<p>回归问题中最知名的变量选择方法是Lasso回归模型(least-absolute-shrinkage-and-selection-operator) <span id="id13">[]</span>。
在常规的OLS标准函数的基础上，Lasso为系数的模 <span class="math notranslate nohighlight">\(L_1\)</span> 增加了惩罚机制。Lasso的标准函数可以写作：</p>
<div class="math notranslate nohighlight">
\[
(2n)^{-1} (Y-X\beta)'(Y-X\beta) + \lambda \Vert \beta \Vert_1
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\lambda \geq 0\)</span> 是一个调谐参数。 与OLS和岭回归不同， Lasso没有一个封闭解。幸运的是，它是一个凸优化问题，因此在高维参数的问题中，它的最优化计算方便又可靠。</p>
<p>在一系列 <span class="math notranslate nohighlight">\(\lambda\)</span> 值中，Lasso 可以把一些系数压缩到0，也就表明了这些参数很可能与回归无关。这样的算法与我们求解微观经济学中效用最大化的 <strong>角点解</strong> 类似。在理论研究方面，<span id="id14">[]</span>发现Lasso无法在所有的情况下区分相关变量和不相关变量。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="p">[</span><span class="n">lasso</span><span class="p">](</span><span class="n">graph</span><span class="o">/</span><span class="n">lasso_regression2.png</span><span class="p">)</span>

<span class="o">!</span><span class="p">[</span><span class="n">SCAD</span><span class="p">](</span><span class="n">graph</span><span class="o">/</span><span class="n">SCAD.png</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>另一个有效的变量选择方法是SCAD(smoothly-clipped-absolute-deviation)
<span id="id15">[]</span>。 其目标函数为：</p>
<div class="math notranslate nohighlight">
\[
(2n)^{-1} (Y-X\beta)'(Y-X\beta) + \sum_{j=1}^d \rho_{\lambda}( |\beta_j| )
\]</div>
<p>当 <span class="math notranslate nohighlight">\(a&gt;2\)</span> 和 <span class="math notranslate nohighlight">\(\theta&gt;0\)</span> 有：</p>
<div class="math notranslate nohighlight">
\[
\rho_{\lambda}^{\prime} (\theta) = \lambda \left\{ 1\{\theta\leq \lambda \} +
\frac{(a\lambda - \theta)_+}{(a-1)\lambda} \cdot 1 \{\theta &gt; \lambda\} \right\}.
\]</div>
<p>这是一个非凸函数。<span id="id16">[]</span>提出了所谓的
<strong>神谕性质</strong>。 具有神谕性质的估计量能够同时拥有变量选择的一致性和(逐点)渐近正态性。</p>
<p>之后提出的 <strong>自适应 Lasso</strong> (adaptive lasso)<span id="id17">[]</span>同样具有神谕性质。
自适应 Lasso 有两个步骤: 1. 首先进行Lasso或者岭回归，得到估计量 <span class="math notranslate nohighlight">\(\hat{\beta}^{(1)}\)</span>. 2. 解</p>
<div class="math notranslate nohighlight">
\[
(2n)^{-1} (Y-X\beta)'(Y-X\beta) + \lambda \sum_{j=1}^d  w_j |\beta_j|
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(w_j = 1 \bigg/ \left|\hat{\beta}_j^{(1)}\right|^a\)</span> 和 <span class="math notranslate nohighlight">\(a\geq 1\)</span> 是常数(通常 <span class="math notranslate nohighlight">\(a = 1\)</span> or 2)。</p>
<p>在R中, <code class="docutils literal notranslate"><span class="pre">glmnet</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">LARS</span></code> 能够实现Lasso， <code class="docutils literal notranslate"><span class="pre">ncvreg</span></code> 可以运行 SCAD。 自适应 Lasso可以在<code class="docutils literal notranslate"><span class="pre">glmnet</span></code> 中用 <code class="docutils literal notranslate"><span class="pre">penalty.factor</span></code> 设置权重来实现。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">&lt;-</span> <span class="m">40</span>
<span class="n">p</span> <span class="o">&lt;-</span> <span class="m">50</span>
<span class="n">b0</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span> <span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="m">10</span><span class="p">))</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">p</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="n">x</span> <span class="o">%*%</span> <span class="n">b0</span> <span class="o">+</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">ols</span> <span class="o">&lt;-</span> <span class="n">MASS</span><span class="o">::</span><span class="nf">ginv</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">x</span><span class="p">)</span> <span class="o">%*%</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># OLS</span>
<span class="c1"># Implement Lasso by glmnet</span>
<span class="n">cv_lasso</span> <span class="o">&lt;-</span> <span class="n">glmnet</span><span class="o">::</span><span class="nf">cv.glmnet</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">lasso_result</span> <span class="o">&lt;-</span> <span class="n">glmnet</span><span class="o">::</span><span class="nf">glmnet</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="n">cv_lasso</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span>

<span class="c1"># Get weights</span>
<span class="n">b_temp</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">lasso_result</span><span class="o">$</span><span class="n">beta</span><span class="p">)</span>
<span class="n">b_temp</span><span class="p">[</span><span class="n">b_temp</span> <span class="o">==</span> <span class="m">0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">1e-8</span>
<span class="n">w</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">/</span> <span class="nf">abs</span><span class="p">(</span><span class="n">b_temp</span><span class="p">)</span> <span class="c1"># Let gamma = 1</span>

<span class="c1"># Implement Adaptive Lasso by glmnet</span>
<span class="n">cv_alasso</span> <span class="o">&lt;-</span> <span class="n">glmnet</span><span class="o">::</span><span class="nf">cv.glmnet</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">penalty.factor</span> <span class="o">=</span> <span class="n">w</span><span class="p">)</span>
<span class="n">alasso_result</span> <span class="o">&lt;-</span>
  <span class="n">glmnet</span><span class="o">::</span><span class="nf">glmnet</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">penalty.factor</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span> <span class="n">lambda</span> <span class="o">=</span> <span class="n">cv_alasso</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-0.8</span><span class="p">,</span> <span class="m">1.5</span><span class="p">),</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;coefficient&quot;</span><span class="p">)</span>
<span class="nf">points</span><span class="p">(</span><span class="n">lasso_result</span><span class="o">$</span><span class="n">beta</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">6</span><span class="p">)</span>
<span class="nf">points</span><span class="p">(</span><span class="n">alasso_result</span><span class="o">$</span><span class="n">beta</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
<span class="nf">points</span><span class="p">(</span><span class="n">ols</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>

<span class="c1"># out of sample prediction</span>
<span class="n">x_new</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">p</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">&lt;-</span> <span class="n">x_new</span> <span class="o">%*%</span> <span class="n">b0</span> <span class="o">+</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">lasso_msfe</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">y_new</span> <span class="o">-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">lasso_result</span><span class="p">,</span> <span class="n">newx</span> <span class="o">=</span> <span class="n">x_new</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">var</span><span class="p">()</span>
<span class="n">alasso_msfe</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">y_new</span> <span class="o">-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">alasso_result</span><span class="p">,</span> <span class="n">newx</span> <span class="o">=</span> <span class="n">x_new</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">var</span><span class="p">()</span>
<span class="n">ols_msfe</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">y_new</span> <span class="o">-</span> <span class="n">x_new</span> <span class="o">%*%</span> <span class="n">ols</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">var</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">lasso_msfe</span><span class="p">,</span> <span class="n">alasso_msfe</span><span class="p">,</span> <span class="n">ols_msfe</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y_new</span> <span class="o">-</span> <span class="n">predict</span><span class="p">(</span><span class="n">lasso_result</span><span class="p">,</span> <span class="n">newx</span> <span class="o">=</span> <span class="n">x_new</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">var</span><span class="p">():</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">function</span> <span class="s2">&quot;%&gt;%&quot;</span>
<span class="ne">Traceback</span>:
</pre></div>
</div>
<img alt="_images/08-ML-CN_15_1.png" src="_images/08-ML-CN_15_1.png" />
</div>
</div>
<p>我们可以用CVXR自己编写Lasso：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">CVXR</span><span class="p">)</span>

<span class="n">lambda</span> <span class="o">&lt;-</span> <span class="m">2</span> <span class="o">*</span> <span class="n">cv_lasso</span><span class="o">$</span><span class="n">lambda.min</span> <span class="c1"># tuning parameter</span>

<span class="c1"># CVXR for Lasso</span>
<span class="n">beta_cvxr</span> <span class="o">&lt;-</span> <span class="nf">Variable</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">&lt;-</span> <span class="nf">sum_squares</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="o">%*%</span> <span class="n">beta_cvxr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="m">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">lambda</span> <span class="o">*</span> <span class="nf">p_norm</span><span class="p">(</span><span class="n">beta_cvxr</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="n">prob</span> <span class="o">&lt;-</span> <span class="nf">Problem</span><span class="p">(</span><span class="nf">Minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
<span class="n">lasso_cvxr</span> <span class="o">&lt;-</span> <span class="nf">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
<span class="n">beta_cvxr_hat</span> <span class="o">&lt;-</span> <span class="n">lasso_cvxr</span><span class="o">$</span><span class="nf">getValue</span><span class="p">(</span><span class="n">beta_cvxr</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">as.vector</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="nf">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
&quot;package &#39;CVXR&#39; was built under R version 4.1.3&quot;

Attaching package: &#39;CVXR&#39;


The following object is masked from &#39;package:stats&#39;:

    power
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>Error in lasso_cvxr$getValue(beta_cvxr) %&gt;% as.vector() %&gt;% print(): could not find function &quot;%&gt;%&quot;
Traceback:
</pre></div>
</div>
</div>
</div>
<p>实际上，如果回归的唯一目的是预测响应变量的话，有更多的方法可供选择。一个符合直觉的方法是 <strong>前向分布回归</strong> (<em>stagewise forward selection</em>)。
我们首先将所有的系数设为0，然后给定许多候选自变量 <span class="math notranslate nohighlight">\(x_j\)</span> ，在每一轮中我们加入能够得到最大的 <span class="math notranslate nohighlight">\(R^2\)</span> 的回归量。这个方法和 <span class="math notranslate nohighlight">\(L_2\)</span> 成分增强的思路类似，不调整先前拟合的系数。</p>
</section>
<section id="id18">
<h2><span class="section-number">7.4. </span>计量经济学中的压缩估计<a class="headerlink" href="#id18" title="永久链接至标题">#</a></h2>
<ul class="simple">
<li><p><span id="id19">[]</span>: 将压缩估计用于分类</p></li>
<li><p><span id="id20">[]</span>: 求解了GMM Lasso的收敛速度</p></li>
<li><p><span id="id21">[]</span>: 预测回归中的Lasso和自适应Lasso</p></li>
<li><p><span id="id22">[]</span>: 前向选择</p></li>
<li><p><span id="id23">[]</span>: 预测组合中的潜在群</p></li>
</ul>
</section>
<section id="id24">
<h2><span class="section-number">7.5. </span>实证应用<a class="headerlink" href="#id24" title="永久链接至标题">#</a></h2>
<ul class="simple">
<li><p><span id="id25">[]</span>: 电影票房</p></li>
<li><p><span id="id26">[]</span>: 因子动物园，比较不同的机器学习方法</p></li>
<li><p><span id="id27">[]</span>: 金融市场，Lasso预测</p></li>
</ul>
</section>
<section id="id28">
<h2><span class="section-number">7.6. </span>拓展阅读<a class="headerlink" href="#id28" title="永久链接至标题">#</a></h2>
<ul class="simple">
<li><p><span id="id29">[]</span>: 第16章</p></li>
<li><p><span id="id30">[]</span></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="07-optimization-CN.html" title="上一页 页">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">上一页</p>
            <p class="prev-next-title"><span class="section-number">6. </span>数值最优化</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="09-ML2-CN.html" title="下一页 页">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">下一页</p>
        <p class="prev-next-title"><span class="section-number">8. </span>基于预测的算法</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By 史震涛 Shi Zhentao<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>